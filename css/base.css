/* ===== BASE STYLES - Original Design System ===== */
:root{
  --bg-paper:#f9f9f9;
  --text:#2d2d2d;
  --border:#2d2d2d;
  --tri:#ffd54f;
  --cir:#4fc3f7;
  --sq:#ff8a80;
  --dict:#b39ddb;
  --shadow: rgba(0,0,0,.18);
  --shadow2: rgba(0,0,0,.10);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background: var(--bg-paper);
  color: var(--text);
  font-family: "Vazirmatn", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Patrick Hand", cursive;
  overflow:hidden;
  line-height:1.85;
}
body::before{
  content:"";
  position:fixed; inset:-60px;
  pointer-events:none;
  opacity:.15;
  background:
    radial-gradient(circle at 18% 28%, rgba(79,195,247,.22) 0 95px, transparent 96px),
    radial-gradient(circle at 78% 30%, rgba(255,213,79,.3) 0 85px, transparent 86px),
    radial-gradient(circle at 70% 78%, rgba(255,138,128,.3) 0 110px, transparent 111px),
    repeating-linear-gradient(135deg,
      rgba(45,45,45,.2) 0px,
      rgba(45,45,45,.2) 2px,
      transparent 2px,
      transparent 12px
    );
  transform: rotate(-1.5deg);
  filter: saturate(.95);
}

/* ===== SCREEN SYSTEM ===== */
.screen{
  position:fixed; inset:0;
  display:none;
  padding: 46px 24px 92px;
  overflow:hidden;
}
.screen.active{display:flex}
.stage{
  width:min(1100px, 100%);
  margin:0 auto;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== CARDS ===== */
.card{
  background:#fff;
  border:3px solid var(--border);
  border-radius: 255px 18px 225px 18px / 18px 225px 18px 255px;
  box-shadow: 6px 6px 0 var(--shadow2);
}
.card.pad{ padding: 26px 26px; }

/* ===== TYPOGRAPHY ===== */
.title-lg{
  font-size: clamp(30px, 3.2vw, 48px);
  font-weight:800;
  margin-bottom:10px;
  line-height:1.35;
}
.title-md{
  font-size: clamp(22px, 2.3vw, 34px);
  font-weight:800;
  margin-bottom:8px;
  line-height:1.35;
}
.subtitle{
  font-size: clamp(14px, 1.5vw, 18px);
  opacity:.9;
}
p{font-size: 17px}
.muted{opacity:.85}

/* ===== BUTTONS ===== */
.btn{
  background:#fff;
  border:3px dashed var(--border);
  border-radius: 225px 18px 255px 18px / 18px 255px 18px 225px;
  padding: 14px 22px;
  font-size: 18px;
  font-weight:700;
  cursor:pointer;
  box-shadow: 5px 5px 0 var(--shadow);
  transition: transform .18s ease, box-shadow .18s ease, background .15s ease;
  font-family: inherit;
}
.btn:hover{ transform: translateY(-2px) rotate(-.5deg); box-shadow: 7px 7px 0 var(--shadow); background:rgba(255,213,79,.08); }
.btn:active{ transform: translateY(0) rotate(0); box-shadow: 3px 3px 0 var(--shadow); }
.btn:disabled{opacity:.55;cursor:not-allowed}
.btn.small{ padding: 10px 16px; font-size: 16px; }

/* ===== ANIMATIONS ===== */
@keyframes floaty {
  0%,100%{ transform: translateY(0px) rotate(-.6deg); }
  50%{ transform: translateY(-10px) rotate(.6deg); }
}
.float{
  animation: floaty 5.2s ease-in-out infinite;
  will-change: transform;
}
.float.slow{ animation-duration: 6.8s; }
.float.fast{ animation-duration: 4.6s; }

@keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }

@keyframes winPop {
  0%{ transform: translateY(10px) scale(.95); opacity:0; }
  100%{ transform: translateY(0) scale(1); opacity:1; }
}
.win-anim{ animation: winPop .55s ease both; }

@keyframes confetti {
  0%{ transform: translateY(-10px) rotate(0); opacity:0; }
  20%{ opacity:1; }
  100%{ transform: translateY(55px) rotate(40deg); opacity:0; }
}

@keyframes laugh{
  0%,100%{ transform: translateY(0px) scaleX(1); }
  50%{ transform: translateY(-2px) scaleX(1.04); }
}

@keyframes twinkle{
  0%,100%{ transform: translate(0,0) scale(.85) rotate(0deg); opacity:.25; }
  50%{ transform: translate(var(--sx), var(--sy)) scale(1.1) rotate(12deg); opacity:1; }
}

@keyframes driftMove {
  0%{ transform: translate(0px, 0px); }
  50%{ transform: translate(var(--dx), var(--dy)); }
  100%{ transform: translate(0px, 0px); }
}

@keyframes slowspin {
  0%{ transform: rotate(0deg); }
  100%{ transform: rotate(360deg); }
}

/* ===== DOODLE ===== */
.doodle{
  font-family:"Patrick Hand", cursive;
  font-size: 22px;
  opacity:.55;
  margin-top: 10px;
  transform: rotate(-2.5deg);
  display:inline-block;
}

/* ===== COVER ===== */
.cover-wrap{
  position:relative;
  width:min(980px, 100%);
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}
.cover-main{
  width:min(1500px, 100%);
  text-align:center;
  padding: 30px 28px;
}
.cover-main .btn{ margin-top: 18px; }
.cover-deco{
  position:absolute;
  inset:0;
  pointer-events:none;
}
.deco-item{
  position:absolute;
  filter: drop-shadow(4px 6px 0 rgba(0,0,0,.08));
  opacity:.95;
  will-change: transform;
}
.deco-item.tri{ left: 7%; top: 18%; width: 130px; }
.deco-item.cir{ right: 10%; top: 20%; width: 130px; }
.deco-item.sq{ left: 14%; bottom: 18%; width: 90px; opacity:.85; }
.parallax-layer{ will-change: transform; transform: translate3d(0,0,0); }
.cover-actions{
  margin-top: 14px;
  display:flex;
  gap: 10px;
  justify-content:center;
  align-items:center;
  pointer-events:auto;
  width: fit-content;
  margin-left:auto;
  margin-right:auto;
}
.cover-actions .dock-btn{
  animation: floaty 5.2s ease-in-out infinite;
  will-change: transform;
}
.cover-actions .dock-btn:nth-child(1){ animation-delay: .1s; }
.cover-actions .dock-btn:nth-child(2){ animation-delay: .35s; }
.cover-title .l1{ display:block; white-space:nowrap; }
.cover-title .l2{ display:block; }

/* ===== LAYOUT ===== */
.stack{
  width:min(980px, 100%);
  display:flex;
  flex-direction:column;
  gap: 18px;
  align-items:center;
}
.candidates-row{
  width:100%;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  align-items:stretch;
}
.layout-3col{
  width:min(1100px, 100%);
  display:grid;
  grid-template-columns: 1fr 1.05fr 1fr;
  gap: 16px;
  align-items:center;
}
.layout-2col{
  width:min(1100px, 100%);
  display:grid;
  grid-template-columns: 1.15fr .85fr;
  gap: 16px;
  align-items:stretch;
}

/* ===== CANDIDATE CARDS ===== */
.cand-card{
  padding: 16px 16px;
  text-align:center;
  display:flex;
  flex-direction:column;
  gap: 10px;
  cursor:default;
}
.cand-name{
  font-weight:800;
  font-size: 18px;
}
.cand-desc{
  font-size: 15px;
  opacity:.9;
  line-height:1.75;
}

/* ===== BALLOT ===== */
.ballot-card{
  width:min(520px, 92vw);
  padding: 18px 18px;
  text-align:center;
}
.ballot-title{
  font-weight:900;
  font-size: 22px;
  margin-bottom: 6px;
}
.ballot-sub{
  font-size: 14px;
  opacity:.85;
  margin-bottom: 12px;
}
.ballot-options{ display:flex; flex-direction:column; gap: 12px; margin-top: 10px; }
.ballot-opt{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 12px 14px;
  border:3px solid var(--border);
  border-radius: 18px 225px 18px 255px / 255px 18px 225px 18px;
  cursor:pointer;
  transition: transform .16s ease, box-shadow .16s ease;
  box-shadow: 3px 3px 0 rgba(0,0,0,.12);
  background:#fff;
  user-select:none;
}
.ballot-opt:hover{ transform: translateY(-2px) rotate(-.3deg); box-shadow: 6px 6px 0 rgba(0,0,0,.12); }
.ballot-opt strong{ font-size: 16px; }

/* ===== GEAR ===== */
.gear{
  width: 62px; height: 62px;
  margin: 8px auto 10px;
  animation: spin 1.6s linear infinite;
  opacity:.85;
}
.center{ text-align:center; }

/* ===== RESULT ===== */
.result-box{
  width:min(900px, 100%);
  display:grid;
  grid-template-columns: 1.3fr .9fr;
  gap: 18px;
  align-items:stretch;
}
.result-text{ padding: 22px 22px; }
.result-text h3{ font-size: 26px; margin-bottom: 10px; }
.winner-panel{
  padding: 18px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap: 10px;
}
.winner-main{
  width: 130px;
  height: auto;
  animation: floaty 4.8s ease-in-out infinite;
}
.winner-main .mouth{
  transform-box: fill-box;
  transform-origin: center;
  animation: laugh 0.36s ease-in-out infinite;
}
.winner-main .star{
  transform-box: fill-box;
  transform-origin: center;
  animation: twinkle 1.05s ease-in-out infinite;
  opacity:.95;
}
.confetti{ position:relative; width: 160px; height: 90px; }
.confetti i{
  position:absolute;
  top:0;
  width: 10px; height: 3px;
  background: var(--border);
  opacity:.35;
  animation: confetti 1.2s ease infinite;
}
.confetti i:nth-child(1){ left:10px; animation-delay:.0s; }
.confetti i:nth-child(2){ left:40px; animation-delay:.15s; }
.confetti i:nth-child(3){ left:70px; animation-delay:.3s; }
.confetti i:nth-child(4){ left:100px; animation-delay:.45s; }
.confetti i:nth-child(5){ left:130px; animation-delay:.6s; }

/* ===== CONDORCET ===== */
.header-card{
  width:min(980px, 100%);
  text-align:center;
  padding: 20px 22px;
  margin: 0 auto 16px;
}
.mini-cand{
  padding: 14px 14px;
  display:flex;
  flex-direction:column;
  gap: 10px;
  text-align:center;
}
.mini-cand .cand-name{ font-size: 17px; }
.mini-cand .cand-desc{ font-size: 14px; }
.pref-card{ padding: 18px 18px; }
.pref-item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  border: 3px solid var(--border);
  border-radius: 18px 225px 18px 255px / 255px 18px 225px 18px;
  padding: 10px 12px;
  margin-top: 10px;
  background:#fff;
}
.pref-item .rank{
  font-weight:900;
  width: 42px;
  text-align:center;
  opacity:.9;
}
.pref-item .label{
  flex:1;
  font-weight:800;
  font-size: 15px;
}

/* ===== TICKETS ===== */
.tickets-top{
  width:min(1100px, 100%);
  display:flex;
  gap: 12px;
  justify-content:center;
  align-items:stretch;
  margin-bottom: 14px;
  flex-wrap:wrap;
}
.ticket{ width: 300px; padding: 14px 14px; }
.ticket h4{ font-size: 18px; margin-bottom: 6px; }
.ticket .tiny{ font-size: 14px; opacity:.85; }

/* ===== COMPARE ===== */
.compare-wrap{
  width:min(980px, 100%);
  display:flex;
  flex-direction:column;
  gap: 14px;
  align-items:center;
}
.compare-box{
  width:100%;
  padding: 18px 18px;
  min-height: 210px;
}
.logline{
  font-size: 16px;
  margin: 10px 0;
  line-height:1.9;
}
.hl-you{ color:#1e88e5; font-weight:900; }
.hl-voter{ color:#2e7d32; font-weight:900; }

/* ===== BG DRIFT ===== */
.bg-drift{
  position:absolute; inset:0;
  pointer-events:none;
  overflow:hidden;
  opacity:.22;
}
.bg-drift .blob{
  position:absolute;
  width: 140px;
  animation: driftMove 10s ease-in-out infinite;
  filter: drop-shadow(4px 6px 0 rgba(0,0,0,.05));
  will-change: transform;
}
.bg-drift .blob:nth-child(1){ left: 8%; top: 18%; animation-duration: 11.2s; --dx: 32px; --dy: -18px; }
.bg-drift .blob:nth-child(2){ right: 9%; top: 22%; animation-duration: 12.8s; --dx: -28px; --dy: 22px; }
.bg-drift .blob:nth-child(3){ left: 16%; bottom: 16%; width: 110px; animation-duration: 13.6s; --dx: 22px; --dy: 26px; }
.bg-drift .spin{
  animation: slowspin 14s linear infinite;
  transform-origin:center;
  will-change: transform;
}

/* ===== CYCLE ===== */
.cycle-panel{
  padding: 16px;
  display:flex;
  flex-direction:column;
  gap: 10px;
  align-items:center;
}
.cycle-title{
  font-weight:900;
  font-size: 18px;
  margin-top: 2px;
}
.cycle-svg{
  width: 100%;
  max-width: 430px;
  height: auto;
  overflow: visible;
  display:block;
}

/* ===== DOCK ===== */
.dock{
  position:fixed;
  left: 22px;
  right: 22px;
  bottom: 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  pointer-events:none;
  z-index: 50;
}
.dock.hidden{ display:none; }
.dock .left, .dock .right, .dock .mid{ pointer-events:auto; }
.dock-btn{
  width: 58px; height: 58px;
  border: 3px solid var(--border);
  background:#fff;
  border-radius: 999px;
  box-shadow: 5px 5px 0 var(--shadow);
  display:grid;
  place-items:center;
  cursor:pointer;
  transition: transform .18s ease, box-shadow .18s ease;
}
.dock-btn:hover{ transform: translateY(-2px) rotate(-.5deg); box-shadow: 7px 7px 0 var(--shadow); }
.dock-btn svg{ width: 26px; height: 26px; }
.dots{
  border: 3px solid var(--border);
  background:#fff;
  border-radius: 999px;
  padding: 10px 14px;
  box-shadow: 5px 5px 0 var(--shadow);
  display:flex;
  gap: 8px;
  align-items:center;
}
.dot{
  width: 10px; height: 10px;
  border: 2px solid var(--border);
  border-radius: 999px;
  cursor:pointer;
  position:relative;
  background: transparent;
  opacity:.6;
}
.dot.active{ background: var(--border); opacity:1; }
.dot.current{ transform: scale(1.25); box-shadow: 0 0 0 2px rgba(45,45,45,.18); }
.dot:hover{ opacity:1; }
.dot[data-title]::after{
  content: attr(data-title);
  position:absolute;
  bottom: 18px;
  left:50%;
  transform: translateX(-50%);
  background:#fff;
  border:2px solid var(--border);
  border-radius: 14px;
  padding: 4px 8px;
  white-space:nowrap;
  font-size: 12px;
  box-shadow: 3px 3px 0 rgba(0,0,0,.1);
  opacity:0;
  pointer-events:none;
  transition: opacity .12s ease, transform .12s ease;
}
.dot:hover::after{
  opacity:1;
  transform: translateX(-50%) translateY(-2px);
}

/* ===== MODAL ===== */
.modal{
  position:fixed; inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,.45);
  z-index: 80;
  padding: 18px;
}
.modal.active{ display:flex; }
.modal-card{
  width: min(520px, 96vw);
  padding: 22px 22px;
  position:relative;
  text-align:center;
}
.closex{
  position:absolute;
  top: 12px; left: 12px;
  width: 44px; height: 44px;
  border-radius: 999px;
  border: 3px solid var(--border);
  background:#fff;
  cursor:pointer;
  box-shadow: 4px 4px 0 var(--shadow);
  font-weight:900;
}
.handle{
  direction:ltr;
  display:inline-block;
  padding: 2px 10px;
  border:2px dashed var(--border);
  border-radius: 14px;
  background: #fff9c4;
  font-weight:800;
  margin-top: 8px;
}

/* ===== COVER DICTATOR PEEK ===== */
.cover-dict-peek{
  position:absolute;
  bottom: -10px;
  right: -30px;
  z-index: 0;
  pointer-events:none;
  opacity:.9;
  transform: rotate(8deg);
  overflow:hidden;
}
.cover-dict-peek .dict-float{
  transform: translateY(30%);
}

/* ===== DICT PEEK BOX (peeking characters) ===== */
.dict-peek-box{
  position:absolute;
  bottom: -16px;
  left: -30px;
  z-index: 1;
  pointer-events:none;
  opacity:.85;
  transform: rotate(-6deg);
}

/* ===== ROAD / HOUSE / POLICE (police game) ===== */
.road-container{
  padding: 20px 20px 30px;
  position:relative;
  overflow: visible;
}
.road{
  position:relative;
  width:100%;
  height: 80px;
  background: linear-gradient(180deg, #e0e0e0 0%, #bdbdbd 100%);
  border-radius: 12px;
  border: 3px solid var(--border);
}
.road::before{
  content:"";
  position:absolute;
  top:50%;
  left:5%;
  right:5%;
  height:3px;
  background: repeating-linear-gradient(90deg, #fff 0px, #fff 18px, transparent 18px, transparent 30px);
  transform: translateY(-50%);
  opacity:.6;
}
.house-icon{
  position:absolute;
  top: -30px;
  transform: translateX(-50%);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 2px;
  z-index: 3;
  transition: left .1s linear;
}
.house-icon.draggable{
  cursor: grab;
  z-index: 5;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,.2));
}
.house-icon.draggable:active{
  cursor: grabbing;
}
.house-num{
  font-size: 11px;
  font-weight: 900;
  color: var(--border);
  white-space: nowrap;
}
.you-house .house-num{
  color: #c62828;
}
.police-icon{
  position:absolute;
  bottom: -24px;
  transform: translateX(-50%);
  z-index: 4;
  transition: left .35s ease;
}
.hidden{
  display: none !important;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 980px){
  .candidates-row{ grid-template-columns: 1fr; }
  .result-box{ grid-template-columns: 1fr; }
  .layout-3col{ grid-template-columns: 1fr; }
  .layout-2col{ grid-template-columns: 1fr; }
  .deco-item.tri{ left: 2%; top: 10%; width: 110px; }
  .deco-item.cir{ right: 2%; top: 10%; width: 110px; }
  .deco-item.sq{ left: 4%; bottom: 14%; width: 80px; }
  .cover-title .l1{ white-space:normal; }
}


@media (max-width: 820px), (hover: none) and (pointer: coarse){
  body{
    overflow-x: hidden;
    overflow-y: auto;
  }
  .screen{
    position: relative;
    inset: auto;
    min-height: 100dvh;
    overflow: visible;
    padding: 24px 14px 84px;
  }
  .screen.active{ display:block; }
  .stage{
    height: auto;
    min-height: calc(100dvh - 108px);
    align-items: flex-start;
  }
}
